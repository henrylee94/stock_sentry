# GEEWONI Stock Sentry – Architecture

Short overview of how the repo is structured and how the bot and backoffice work.

## Entry points

| File | Role |
|------|------|
| `telegram_bot.py` | Telegram bot + 9 AM news scheduler (single process). Handles messages, runs agent pipeline or function-calling path, calls OpenAI. |
| `tradesniper.py` | Streamlit backoffice: config, trades, strategies, analytics. Run with `streamlit run tradesniper.py`. |

Both use shared code: `core/`, `intent_detector.py`, `rules_engine.py`, `skills/`, `ai_rules/`.

## Agents vs strategy agents

- **`agents/`** – Pipeline agents used by the bot for each request:
  - **Analyzer** – Intent + symbol resolution.
  - **Technical Analyst** – Fetches and formats stock data (one block per symbol).
  - **Strategy Generator** – Picks top 2 strategies from `strategies.json` (by win rate / P&L).
  - **Backtester agent** – Thin wrapper: calls `backtester.run_backtest(symbol, orchestrator)` and returns one line of text.
  - **Final Decision** – Builds system + user prompt from all context; bot calls OpenAI with that.
  - **Tools** – OpenAI function-calling: `get_stock_data`, `run_backtest`, `get_news` (optional path when `USE_FUNCTION_CALLING` is True).

- **`strategy_agents/`** – One **rule-based** evaluator per skill (e.g. EMA Crossover, RSI, Volume Breakout). Each reads market data and returns BUY/SELL/HOLD + confidence. **StrategyOrchestrator** runs all of them and returns a consensus. Used inside the pipeline (consensus line) and inside `backtester.run_backtest()`.

So: `agents/` = request-level pipeline and tools; `strategy_agents/` = per-strategy signal evaluators.

## Backtester

- **`backtester.py`** (root) – Engine: fetches 60d history, builds daily market_data, calls `orchestrator.get_consensus_signal()` each day, returns BUY/SELL/HOLD counts.
- **`agents/backtester_agent.py`** – Wrapper used by the bot: calls `backtester.run_backtest()` and formats the result as a single line for the Final Decision context (or for the `run_backtest` tool when function calling is used).

## Config and data (root)

- `geewoni_config.json` – Runtime config (watchlist, weekly goal, etc.); see `core/config.py`.
- `strategies.json` – Per-strategy P&L and win/loss; written by backoffice/trades.
- `stock_aliases_override.json` – Extra symbol aliases; merged when running `scripts/update_stock_list.py`.
- `stock_aliases.json` – Generated by the script (gitignored); used by `intent_detector` for symbol resolution. If missing, alias map is built from `nasdaq_screener_*.csv` at runtime.

## Docs

- **`docs/`** – Guides and references (snake_case filenames): `startup_guide.md`, `complete_integration_guide.md`, `fixes_quick_reference.md`, `tradesniper_guide.md`, `skills_library.md`, `phase1_progress.md`, `PROJECT_STRUCTURE_REVIEW.md`.
- **`docs/planning/`** – Planning and Q&A: `new_requirement.md`, `user_qna.md`.
